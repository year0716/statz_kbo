<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>stats.kbo</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: center;
            font-size: 12px;
        }
        th {
            background-color: #f2f2f2;
            cursor: pointer;
        }
        th.sorted-asc::after {
            content: "▲";
        }
        th.sorted-desc::after {
            content: "▼";
        }
        .filter-container {
            margin-bottom: 20px;
        }
        .filter-container select, .filter-container input {
            padding: 5px;
            margin-right: 10px;
        }
    </style>
</head>
<body>

    <h1>
        stats.kbo
        <span style="font-size: 10px; color: #666; margin-left: 10px;">( 선수 성적 출처 : fangraphs.com / 문제 시 삭제 )</span>
    </h1>

    <div class="filter-container">
        <label for="teamFilter">팀:</label>
        <select id="teamFilter">
            <option value="">All</option>
            <option value="Landers (KBO)">Landers (KBO)</option>
            <option value="Wiz (KBO)">Wiz (KBO)</option>
            <option value="Twins (KBO)">Twins (KBO)</option>
            <option value="Heroes (KBO)">Heroes (KBO)</option>
            <option value="Bears (KBO)">Bears (KBO)</option>
            <option value="Eagles (KBO)">Eagles (KBO)</option>
            <option value="Lions (KBO)">Lions (KBO)</option>
            <option value="Dinos (KBO)">Dinos (KBO)</option>
            <option value="Giants (KBO)">Giants (KBO)</option>
            <option value="Tigers (KBO)">Tigers (KBO)</option>
        </select>

        <label for="plateAppearancesFilter">타석 수:</label>
        <input type="number" id="plateAppearancesFilter" value="300" placeholder="Enter minimum PA">

        <label for="nameSearch">선수 이름:</label>
        <input type="text" id="nameSearch" placeholder="Search by name">
    </div>

    <table id="statsTable">
        <thead>
            <tr>
                <th data-column="name">이름</th>
                <th data-column="team">팀</th>
                <th data-column="wRC">wRC+</th>
                <th data-column="oWAR">oWAR</th>
                <th data-column="atBats">타수</th>
                <th data-column="plateAppearances">타석</th>
                <th data-column="hits">안타</th>
                <th data-column="doubles">2루타</th>
                <th data-column="triples">3루타</th>
                <th data-column="homeRuns">홈런</th>
                <th data-column="walks">4구(고4X)</th>
                <th data-column="hitByPitch">사구</th>
                <th data-column="sacFlies">희비</th>
                <th data-column="sacBunts">희번</th>
                <th data-column="intentionalWalks">고4</th>
                <th data-column="strikeouts">삼진</th>
                <th data-column="doublePlays">병살</th>
                <th data-column="steals">도루</th>
                <th data-column="caughtStealing">도루실패</th>
                <th data-column="runs">득점</th>
                <th data-column="rbis">타점</th>
                <th data-column="avg">타율</th>
                <th data-column="obp">출루율</th>
                <th data-column="slg">장타율</th>
                <th data-column="ops">OPS</th>
                <th data-column="wOBA">wOBA</th>
                <th data-column="wRAA">wRAA</th>
                <th data-column="wSB">wSB</th>
                <th data-column="spd">Spd</th>
                <th data-column="ubr">추정UBR</th>
            </tr>
        </thead>
        <tbody>
        </tbody>
    </table>

    <script>
        const csvUrl = 'https://raw.githubusercontent.com/year0716/statz_kbo/main/stat.csv';

        function fetchAndParseCSV(url) {
            return fetch(url)
                .then(response => response.text())
                .then(text => parseCSV(text));
        }

        function parseCSV(text) {
            const rows = text.trim().split('\n').slice(1);
            return rows.map(row => {
                const columns = row.split(',');
                return {
                    name: columns[0],
                    team: columns[1,  
                    wRC: columns[2],
                    oWAR: parseFloat(columns[3]),
                    atBats: columns[4],
                    plateAppearances: parseInt(columns[5], 10),
                    hits: columns[6],
                    doubles: columns[7],
                    triples: columns[8],
                    homeRuns: columns[9],
                    walks: columns[10],
                    hitByPitch: columns[11],
                    sacFlies: columns[12],
                    sacBunts: columns[13],
                    intentionalWalks: columns[14],
                    strikeouts: columns[15],
                    doublePlays: columns[16],
                    steals: columns[17],
                    caughtStealing: columns[18],
                    runs: columns[19],
                    rbis: columns[20],
                    avg: columns[21],
                    obp: columns[22],
                    slg: columns[23],
                    ops: columns[24],
                    wOBA: columns[25],
                    wRAA: columns[26],
                    wSB: columns[27],
                    spd: columns[28],
                    ubr: columns[29]
                };
            });
        }

        function populateTable(data) {
            const tbody = document.querySelector('#statsTable tbody');
            tbody.innerHTML = ''; // Clear existing data
            data.forEach(item => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${item.name}</td>
                    <td>${item.team}</td>
                    <td>${item.wRC}</td>
                    <td>${item.oWAR}</td>
                    <td>${item.atBats}</td>
                    <td>${item.plateAppearances}</td>
                    <td>${item.hits}</td>
                    <td>${item.doubles}</td>
                    <td>${item.triples}</td>
                    <td>${item.homeRuns}</td>
                    <td>${item.walks}</td>
                    <td>${item.hitByPitch}</td>
                    <td>${item.sacFlies}</td>
                    <td>${item.sacBunts}</td>
                    <td>${item.intentionalWalks}</td>
                    <td>${item.strikeouts}</td>
                    <td>${item.doublePlays}</td>
                    <td>${item.steals}</td>
                    <td>${item.caughtStealing}</td>
                    <td>${item.runs}</td>
                    <td>${item.rbis}</td>
                    <td>${item.avg}</td>
                    <td>${item.obp}</td>
                    <td>${item.slg}</td>
                    <td>${item.ops}</td>
                    <td>${item.wOBA}</td>
                    <td>${item.wRAA}</td>
                    <td>${item.wSB}</td>
                    <td>${item.spd}</td>
                    <td>${item.ubr}</td>
                `;
                tbody.appendChild(row);
            });
        }

        function filterData(data) {
            const teamFilter = document.querySelector('#teamFilter').value;
            const plateAppearancesFilter = document.querySelector('#plateAppearancesFilter').value;
            const nameSearch = document.querySelector('#nameSearch').value.toLowerCase();

            return data.filter(item => {
                const matchesTeam = teamFilter === '' || item.team === teamFilter;
                const matchesPA = plateAppearancesFilter === '' || item.plateAppearances >= plateAppearancesFilter;
                const matchesName = nameSearch === '' || item.name.toLowerCase().includes(nameSearch);

                return matchesTeam && matchesPA && matchesName;
            });
        }

        function sortTable(column, ascending) {
            const tbody = document.querySelector('#statsTable tbody');
            const rows = Array.from(tbody.querySelectorAll('tr'));
            const index = Array.from(document.querySelectorAll('th')).findIndex(th => th.getAttribute('data-column') === column);

            rows.sort((a, b) => {
                const aValue = column === 'oWAR' ? parseFloat(a.children[index].textContent) : a.children[index].textContent;
                const bValue = column === 'oWAR' ? parseFloat(b.children[index].textContent) : b.children[index].textContent;

                if (isNaN(aValue) || isNaN(bValue)) {
                    // String comparison if values are not numbers
                    return ascending ? aValue.localeCompare(bValue) : bValue.localeCompare(aValue);
                }

                // Number comparison
                return ascending ? aValue - bValue : bValue - aValue;
            });

            rows.forEach(row => tbody.appendChild(row));
            document.querySelectorAll('th').forEach(th => th.classList.remove('sorted-asc', 'sorted-desc'));
            const header = document.querySelector(`th[data-column="${column}"]`);
            if (ascending) {
                header.classList.add('sorted-asc');
            } else {
                header.classList.add('sorted-desc');
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            fetchAndParseCSV(csvUrl).then(data => {
                const initialFilteredData = filterData(data);
                populateTable(initialFilteredData);
                sortTable('oWAR', false); // Initial sort by oWAR descending

                // Event listeners for filter inputs
                document.querySelector('#teamFilter').addEventListener('change', () => {
                    const filteredData = filterData(data);
                    populateTable(filteredData);
                });

                document.querySelector('#plateAppearancesFilter').addEventListener('input', () => {
                    const filteredData = filterData(data);
                    populateTable(filteredData);
                });

                document.querySelector('#nameSearch').addEventListener('input', () => {
                    const filteredData = filterData(data);
                    populateTable(filteredData);
                });

                document.querySelectorAll('th').forEach(th => {
                    th.addEventListener('click', () => {
                        const column = th.getAttribute('data-column');
                        const isAscending = !th.classList.contains('sorted-asc');
                        sortTable(column, isAscending);
                    });
                });
            });
        });
    </script>

</body>
</html>
