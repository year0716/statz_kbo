<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KBO Player Stats</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: center;
            font-size: 12px; /* 글씨 크기 조정 */
        }
        th {
            background-color: #f2f2f2;
            cursor: pointer; /* 커서 스타일 추가 */
        }
        th.sorted-asc::after {
            content: "▲";
        }
        th.sorted-desc::after {
            content: "▼";
        }
        .filter-container {
            margin-bottom: 20px;
        }
        .filter-container select, .filter-container input {
            padding: 5px;
            margin-right: 10px;
        }
    </style>
</head>
<body>

    <h1>KBO Player Stats</h1>

    <div class="filter-container">
        <label for="teamFilter">팀:</label>
        <select id="teamFilter">
            <option value="">All</option>
            <!-- Options will be populated by JavaScript -->
        </select>

        <label for="plateAppearancesFilter">타석 수:</label>
        <input type="number" id="plateAppearancesFilter" placeholder="Enter minimum PA">
    </div>

    <table id="statsTable">
        <thead>
            <tr>
                <th>이름</th>
                <th>팀</th>
                <th>wRC+</th>
                <th>oWAR</th>
                <th>타수</th>
                <th>타석</th>
                <th>안타</th>
                <th>2루타</th>
                <th>3루타</th>
                <th>홈런</th>
                <th>4구(고4X)</th>
                <th>사구</th>
                <th>희비</th>
                <th>희번</th>
                <th>고4</th>
                <th>삼진</th>
                <th>병살</th>
                <th>도루</th>
                <th>도루실패</th>
                <th>득점</th>
                <th>타점</th>
                <th>타율</th>
                <th>출루율</th>
                <th>장타율</th>
                <th>OPS</th>
                <th>wOBA</th>
                <th>wRAA</th>
                <th>wSB</th>
                <th>Spd</th>
                <th>추정UBR</th>
            </tr>
        </thead>
        <tbody>
        </tbody>
    </table>

    <script>
        const csvUrl = 'https://raw.githubusercontent.com/yourusername/yourrepo/main/player_stats.csv';

        function fetchAndParseCSV(url) {
            return fetch(url)
                .then(response => response.text())
                .then(text => parseCSV(text));
        }

        function parseCSV(text) {
            const rows = text.split('\n').slice(1);
            return rows.map(row => {
                const columns = row.split(',');
                return {
                    name: columns[0],
                    team: columns[1],
                    wRC: columns[2],
                    oWAR: columns[3],
                    atBats: columns[4],
                    plateAppearances: parseInt(columns[5], 10),
                    hits: columns[6],
                    doubles: columns[7],
                    triples: columns[8],
                    homeRuns: columns[9],
                    walks: columns[10],
                    hitByPitch: columns[11],
                    sacFlies: columns[12],
                    sacBunts: columns[13],
                    intentionalWalks: columns[14],
                    strikeouts: columns[15],
                    doublePlays: columns[16],
                    steals: columns[17],
                    caughtStealing: columns[18],
                    runs: columns[19],
                    rbis: columns[20],
                    avg: columns[21],
                    obp: columns[22],
                    slg: columns[23],
                    ops: columns[24],
                    wOBA: columns[25],
                    wRAA: columns[26],
                    wSB: columns[27],
                    spd: columns[28],
                    ubr: columns[29]
                };
            });
        }

        function populateTable(data) {
            const tbody = document.querySelector('#statsTable tbody');
            tbody.innerHTML = ''; // Clear existing data
            data.forEach(item => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${item.name}</td>
                    <td>${item.team}</td>
                    <td>${item.wRC}</td>
                    <td>${item.oWAR}</td>
                    <td>${item.atBats}</td>
                    <td>${item.plateAppearances}</td>
                    <td>${item.hits}</td>
                    <td>${item.doubles}</td>
                    <td>${item.triples}</td>
                    <td>${item.homeRuns}</td>
                    <td>${item.walks}</td>
                    <td>${item.hitByPitch}</td>
                    <td>${item.sacFlies}</td>
                    <td>${item.sacBunts}</td>
                    <td>${item.intentionalWalks}</td>
                    <td>${item.strikeouts}</td>
                    <td>${item.doublePlays}</td>
                    <td>${item.steals}</td>
                    <td>${item.caughtStealing}</td>
                    <td>${item.runs}</td>
                    <td>${item.rbis}</td>
                    <td>${item.avg}</td>
                    <td>${item.obp}</td>
                    <td>${item.slg}</td>
                    <td>${item.ops}</td>
                    <td>${item.wOBA}</td>
                    <td>${item.wRAA}</td>
                    <td>${item.wSB}</td>
                    <td>${item.spd}</td>
                    <td>${item.ubr}</td>
                `;
                tbody.appendChild(row);
            });
        }

        function populateTeamFilter(data) {
            const teamFilter = document.querySelector('#teamFilter');
            const teams = new Set(data.map(item => item.team));
            teams.forEach(team => {
                const option = document.createElement('option');
                option.value = team;
                option.textContent = team;
                teamFilter.appendChild(option);
            });
        }

        function applyFilters(data) {
            const teamFilter = document.querySelector('#teamFilter').value;
            const minPA = parseInt(document.querySelector('#plateAppearancesFilter').value, 10) || 0;

            const filteredData = data.filter(item => 
                (teamFilter === '' || item.team === teamFilter) &&
                item.plateAppearances >= minPA
            );

            populateTable(filteredData);
        }

        function sortTable(columnIndex, isNumeric, ascending) {
            const table = document.querySelector('#statsTable');
            const rows = Array.from(table.querySelectorAll('tbody tr'));

            rows.sort((rowA, rowB) => {
                const cellA = rowA.children[columnIndex].textContent;
                const cellB = rowB.children[columnIndex].textContent;

                let valueA = isNumeric ? parseFloat(cellA) : cellA.toLowerCase();
                let valueB = isNumeric ? parseFloat(cellB) : cellB.toLowerCase();

                if (isNumeric) {
                    if (valueA < valueB) return ascending ? -1 : 1;
                    if (valueA > valueB) return ascending ? 1 : -1;
                } else {
                    if (valueA < valueB) return ascending ? -1 : 1;
                    if (valueA > valueB) return ascending ? 1 : -1;
                }
                return 0;
            });

            const tbody = table.querySelector('tbody');
            rows.forEach(row => tbody.appendChild(row));
        }

        function initializeTable() {
            fetchAndParseCSV(csvUrl).then(data => {
                populateTable(data);
                populateTeamFilter(data);

                document.querySelectorAll('#statsTable th').forEach((header, index) => {
                    header.addEventListener('click', () => {
                        const isNumeric = index > 1; // Assuming columns after the second one are numeric
                        const ascending = !header.classList.contains('sorted-asc');
                        document.querySelectorAll('#statsTable th').forEach(th => th.classList.remove('sorted-asc', 'sorted-desc'));
                        header.classList.add(ascending ? 'sorted-asc' : 'sorted-desc');
                        sortTable(index, isNumeric, ascending);
                    });
                });

                document.querySelector('#teamFilter').addEventListener('change', () => applyFilters(data));
                document.querySelector('#plateAppearancesFilter').addEventListener('input', () => applyFilters(data));
            });
        }

        initializeTable();
    </script>

</body>
</html>

